{% extends "auctions/layout.html" %} {% block body %}
    {% if not listing.isActive and user.is_authenticated and user == listing.initial_bid.user  %}
            <div class="alert alert-success">
                <strong>CONGRATS!!! YOU ARE THE WINNER OF THIS AUCTION</strong>
            </div>
    {% endif %}

    <div class="row d-flex flex-column">
        <p class="text-capitalize">
            <strong>Current bid: $ </strong>{{listing.initial_bid.bid}}
        </p>
    {% if user.is_authenticated and listing.isActive %}
    
        {% if message %}
            {% if update %}
                <div class="alert alert-success">
                    <strong>{{ message }}</strong>
                </div>
            {% else %}
                <div class="alert alert-danger">
                    <strong>{{ message }}</strong>
                </div>
            {% endif %}
        {% endif %}
        <form class="d-flex align-items-center" action="{% url 'updateBid' listing_id=listing.id %}" method="POST">
            {% csrf_token %}
            <label for="#new-bid" class="mb-0 mr-2"> Add your bid: </label>
            <input
            type="number"
            class="mr-2"
            id="new-bid"
            name="new-bid"
            value="{{listing.initial_bid.bid}}"
            min="{{listing.initial_bid.bid}}"
            />
            <button class="btn btn-primary" type="submit">Send Bid</button>
        </form>
        {% if isListingOwner %}
            <form action="{% url 'closeAuction'  listing_id=listing.id %}" method="POST" class="mt-2">
                {% csrf_token %}
                <button class="btn btn-warning my-3" type="submit">Close Auction</button>
            </form>
        {% endif %}

        {% if isInWatchlist %}
            <form
                action="{% url 'removeWatchlist' listing_id=listing.id %}"
                method="POST"
            >
                {% csrf_token %}
                <button class="btn btn-warning my-3" type="submit">Remove from my watchlist</button>
            </form>
        {% else %}
            <form action="{% url 'addWatchlist' listing_id=listing.id %}" method="POST">
                {% csrf_token %}
                <button class="btn btn-info my-3" type="submit">Add to my watchlist</button>
            </form>
        {% endif %} 
    {% endif %}
    
    </div>

    <div class="row d-flex mt-3">
    <div class="col">
        <img
        src="{{ listing.url }}"
        class="img-fluid rounded-start"
        alt="{{ listing.title }}"
        style="width: 300px; height: 300px"
        />

        <h2 class="mt-5">Item: {{listing.title}}</h2>
        <p class="text-capitalize">
        <strong>Category: </strong>{{ listing.category }}
        </p>
        <p class="text-capitalize"><strong>Owner: </strong>{{ listing.owner }}</p>
        {% if listing.isActive %}
            <p class="text-capitalize"><strong>Listing Status: </strong>Active</p>
        {% else %}
            <p class="text-capitalize"><strong>Listing Status: </strong>Closed</p>
        {% endif %}
        <p class="text-capitalize">
        <strong>Description: </strong>{{ listing.description }}
        </p>
    </div>
    </div>

    <div class="card w-50 p-3 bg-light">
    <h3>Comments:</h3>
    {% if user.is_authenticated %}
    <form action="{% url 'addComment' listing.id %}" method="POST">
        {% csrf_token %}
        <label for="#new-comment">Add Comment</label>
        <input
        type="textarea"
        placeholder="Comment"
        name="comment"
        id="new-comment"
        />
        <button type="submit" class="btn btn-primary">Add comment</button>
    </form>
    {% endif%} 
    {% for comment in comments %}
    <div class="card p-1 my-2">
        <p class="mb-0">{{ comment.listingComment }}</p>
        <p class="mb-0 small capitalized text-capitalize">Author: {{ comment.author }}</p>
    </div>
    {% endfor %}
    </div>

{% endblock %}
